!function(t){"use strict";function e(t,e,n,o){try{var s=new XMLHttpRequest,r=!1;e=e||{},s.onreadystatechange=function(){if(s.readyState===s.DONE)if(s.status>=200&&s.status<400){var e=void 0;try{e=JSON.parse(s.responseText),n(e)}catch(t){return o(t)}}else{if(!(0===s.status&&s.timeout>0))return o(new Error("Request to "+t+" failed with status: "+s.status));setTimeout((function(){if(!r)return o(new Error("Request to "+t+" failed with status: "+s.status))}),500)}},s.open(e.method||"GET",t,!0),e.timeout?s.timeout=e.timeout:s.timeout=1e4,s.ontimeout=function(){return r=!0,o(new Error("Request to "+t+" timed out"))};var i=e.headers||{};for(var a in i)s.setRequestHeader(a,i[a]);s.send(e.body||null)}catch(t){return o(t)}}function n(t){var e=t.split("?");return{address:e[0],params:(e[1]||"").split("&").filter(Boolean)}}function o(t){return[t.address,t.params.join("&")].join("?").replace(/\??$/,"")}function s(t,e,n){t+="=";for(var o=0;e.length>o;o++)if(e[o].trim().slice(0,t.length)===t){var s=e[o].trim().slice(t.length);if(!n)return s;n(o,s)}}function r(t){var e=t.name,n=t.value,o=t.lifetime,s=n;document.cookie=e.concat("=",s).concat("; path=/","; max-age=".concat(o.toString()),"https:"===document.location.protocol?"; Secure":"")}function i(t,e){t+="=";for(var n=document.cookie.split(";"),o=null,s=0;s<n.length;s++){var r=n[s].trim();if(0===r.indexOf(t)){o=r;break}}return o?decodeURIComponent(o.trim().slice(t.length)):e||null}var a=function(){function t(e){this.uidFromCookie=s(t.UID_KEY,document.cookie.split(";")),this.uidFromUrl=s(t.UID_KEY,n(location.href).params),this.baseUrl=e}return t.UID_KEY="gov_singleconsent_uid",t.CONSENTS_COOKIE_NAME="cookies_policy",t.PREFERENCES_SET_COOKIE_NAME="cookies_preferences_set",t.COOKIE_LIFETIME=31536e3,t}(),u=function(){function t(t){this.version="v1",this.baseUrl=t}return t.prototype.buildUrl=function(t,e){var n="".concat(this.baseUrl,"/api/").concat(this.version).concat(t);return e&&(n+="/".concat(e)),n},t.prototype.origins=function(){return this.buildUrl(t.Routes.origins)},t.prototype.consents=function(e){return this.buildUrl(t.Routes.consents,e||"")},t.Routes={origins:"/origins",consents:"/consent"},t}(),c=function(){function t(t,e){this.cachedConsentsCookie=null,this.validateConstructorArguments(e,t);var n=this.resolveBaseUrl(e);this._consentsUpdateCallback=t,this.config=new a(n),this.urls=new u(this.config.baseUrl),window.cachedConsentsCookie=null,this.hideUIDParameter(),this.initialiseUIDandConsents()}return t.prototype.validateConstructorArguments=function(t,e){if(!t)throw new Error("Argument baseUrl is required");if("string"!=typeof t)throw new Error("Argument baseUrl must be a string");if(!e)throw new Error("Argument consentsUpdateCallback is required");if("function"!=typeof e)throw new Error("Argument consentsUpdateCallback must be a function")},t.prototype.resolveBaseUrl=function(t){return"staging"===t?"https://gds-single-consent-staging.app":"production"===t?"https://gds-single-consent.app":t},t.prototype.initialiseUIDandConsents=function(){var t=this.getCurrentUID();this.isNewUID(t)&&this.handleNewUID(t),this.uid?this.fetchAndUpdateConsents():this._consentsUpdateCallback(null,!1,null)},t.prototype.handleNewUID=function(t){this.uid=t,this.updateLinksEventHandlers(t),this.setUIDCookie(t)},t.prototype.isNewUID=function(t){return t&&t!==this.uid},t.prototype.fetchAndUpdateConsents=function(){var n=this;e(this.urls.consents(this.uid),{timeout:1e3},(function(e){if(!function(t){try{if("object"!=typeof t||null===t)return!1;for(var e=["essential","settings","usage","campaigns"],n=!0,o=0,s=0;s<e.length;s++)if(!(e[s]in t)){n=!1;break}var r=!0;for(var i in t)if(t.hasOwnProperty(i)&&(o++,"boolean"!=typeof t[i])){r=!1;break}var a=o===e.length}catch(t){return!1}return n&&r&&a}(e.status)){var o=new Error("Invalid consents object returned from the API: "+JSON.stringify(e));return n.defaultToRejectAllConsents(o)}var s=e.status;n.updateBrowserConsents(s),n._consentsUpdateCallback(s,t.isConsentPreferencesSet(),null)}),(function(t){return n.defaultToRejectAllConsents(t)}))},t.prototype.getCurrentUID=function(){return this.config.uidFromUrl||this.config.uidFromCookie},t.prototype.setConsents=function(n){var o=this;if(!n)throw new Error("consents is required in GovSingleConsent.setConsents()");e(this.urls.consents(this.uid),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"status=".concat(JSON.stringify(n))},(function(e){if(!e.uid)throw new Error("No UID returned from the API");o.isNewUID(e.uid)&&o.handleNewUID(e.uid),o.updateBrowserConsents(n),o._consentsUpdateCallback(n,t.isConsentPreferencesSet(),null)}),(function(t){return o.defaultToRejectAllConsents(t)}))},t.prototype.defaultToRejectAllConsents=function(e){this.updateBrowserConsents(t.REJECT_ALL),this._consentsUpdateCallback(t.REJECT_ALL,t.isConsentPreferencesSet(),e)},t.getConsents=function(){if(window.cachedConsentsCookie)return window.cachedConsentsCookie;var t=i(a.CONSENTS_COOKIE_NAME,null);return t?JSON.parse(t):null},t.hasConsentedToEssential=function(){var e=t.getConsents();return null==e?void 0:e.essential},t.hasConsentedToUsage=function(){var e=t.getConsents();return null==e?void 0:e.usage},t.hasConsentedToCampaigns=function(){var e=t.getConsents();return null==e?void 0:e.campaigns},t.hasConsentedToSettings=function(){var e=t.getConsents();return null==e?void 0:e.settings},t.isConsentPreferencesSet=function(){return"true"===i(a.PREFERENCES_SET_COOKIE_NAME,null)},t.prototype.updateLinksEventHandlers=function(t){var n=this;e(this.urls.origins(),{},(function(e){return n.addUIDtoCrossOriginLinks(e,t)}),(function(t){throw t}))},t.prototype.addUIDtoCrossOriginLinks=function(t,e){var r=document.querySelectorAll("a[href]");Array.prototype.forEach.call(r,(function(r){(function(t){return t.protocol!==window.location.protocol||t.hostname!==window.location.hostname||(t.port||"80")!==(window.location.port||"80")})(r)&&t.indexOf(function(t){var e=t.protocol.concat("//",t.hostname);return t.port&&"80"!==t.port&&"443"!==t.port&&(e=e.concat(":",t.port)),e}(r))>=0&&r.addEventListener("click",(function(t){t.target.href=function(t,e,r){t=n(t);var i=e.concat("=",r),a=!1;return s(e,t.params,(function(e){t.params[e]=i,a=!0})),a||t.params.push(i),o(t)}(t.target.href,a.UID_KEY,e)}))}))},t.prototype.setUIDCookie=function(t){r({name:a.UID_KEY,value:t,lifetime:a.COOKIE_LIFETIME})},t.prototype.updateBrowserConsents=function(t){this.setConsentsCookie(t),this.setPreferencesSetCookie(!0),window.cachedConsentsCookie=t},t.prototype.setConsentsCookie=function(t){r({name:a.CONSENTS_COOKIE_NAME,value:JSON.stringify(t),lifetime:a.COOKIE_LIFETIME})},t.prototype.setPreferencesSetCookie=function(t){r({name:a.PREFERENCES_SET_COOKIE_NAME,value:t.toString(),lifetime:a.COOKIE_LIFETIME})},t.prototype.hideUIDParameter=function(){var t;history.replaceState(null,null,(t=location.href,s(a.UID_KEY,(t=n(t)).params,(function(e){t.params.splice(e--,1)})),o(t)))},t.ACCEPT_ALL={essential:!0,usage:!0,campaigns:!0,settings:!0},t.REJECT_ALL={essential:!0,usage:!1,campaigns:!1,settings:!1},t}();"undefined"==typeof module&&(window.GovSingleConsent=c),t.GovSingleConsent=c}({});
