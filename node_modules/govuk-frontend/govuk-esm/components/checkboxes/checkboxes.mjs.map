{"version":3,"file":"checkboxes.mjs","sources":["../../../../src/govuk/components/checkboxes/checkboxes.mjs"],"sourcesContent":["/* eslint-disable es-x/no-function-prototype-bind -- Polyfill imported */\n\nimport { nodeListForEach } from '../../common/index.mjs'\nimport '../../vendor/polyfills/Element/prototype/classList.mjs'\nimport '../../vendor/polyfills/Event.mjs' // addEventListener, event.target normalization and DOMContentLoaded\nimport '../../vendor/polyfills/Function/prototype/bind.mjs'\n\n/**\n * Checkboxes component\n *\n * @class\n * @param {Element} $module - HTML element to use for checkboxes\n */\nfunction Checkboxes ($module) {\n  if (!($module instanceof HTMLElement)) {\n    return this\n  }\n\n  var $inputs = $module.querySelectorAll('input[type=\"checkbox\"]')\n  if (!$inputs.length) {\n    return this\n  }\n\n  /** @deprecated Will be made private in v5.0 */\n  this.$module = $module\n\n  /** @deprecated Will be made private in v5.0 */\n  this.$inputs = $inputs\n}\n\n/**\n * Initialise component\n *\n * Checkboxes can be associated with a 'conditionally revealed' content block –\n * for example, a checkbox for 'Phone' could reveal an additional form field for\n * the user to enter their phone number.\n *\n * These associations are made using a `data-aria-controls` attribute, which is\n * promoted to an aria-controls attribute during initialisation.\n *\n * We also need to restore the state of any conditional reveals on the page (for\n * example if the user has navigated back), and set up event handlers to keep\n * the reveal in sync with the checkbox state.\n */\nCheckboxes.prototype.init = function () {\n  // Check that required elements are present\n  if (!this.$module || !this.$inputs) {\n    return\n  }\n\n  var $module = this.$module\n  var $inputs = this.$inputs\n\n  nodeListForEach($inputs, function ($input) {\n    var targetId = $input.getAttribute('data-aria-controls')\n\n    // Skip checkboxes without data-aria-controls attributes, or where the\n    // target element does not exist.\n    if (!targetId || !document.getElementById(targetId)) {\n      return\n    }\n\n    // Promote the data-aria-controls attribute to a aria-controls attribute\n    // so that the relationship is exposed in the AOM\n    $input.setAttribute('aria-controls', targetId)\n    $input.removeAttribute('data-aria-controls')\n  })\n\n  // When the page is restored after navigating 'back' in some browsers the\n  // state of form controls is not restored until *after* the DOMContentLoaded\n  // event is fired, so we need to sync after the pageshow event in browsers\n  // that support it.\n  window.addEventListener(\n    'onpageshow' in window ? 'pageshow' : 'DOMContentLoaded',\n    this.syncAllConditionalReveals.bind(this)\n  )\n\n  // Although we've set up handlers to sync state on the pageshow or\n  // DOMContentLoaded event, init could be called after those events have fired,\n  // for example if they are added to the page dynamically, so sync now too.\n  this.syncAllConditionalReveals()\n\n  // Handle events\n  $module.addEventListener('click', this.handleClick.bind(this))\n}\n\n/**\n * Sync the conditional reveal states for all checkboxes in this $module.\n *\n * @deprecated Will be made private in v5.0\n */\nCheckboxes.prototype.syncAllConditionalReveals = function () {\n  nodeListForEach(this.$inputs, this.syncConditionalRevealWithInputState.bind(this))\n}\n\n/**\n * Sync conditional reveal with the input state\n *\n * Synchronise the visibility of the conditional reveal, and its accessible\n * state, with the input's checked state.\n *\n * @deprecated Will be made private in v5.0\n * @param {HTMLInputElement} $input - Checkbox input\n */\nCheckboxes.prototype.syncConditionalRevealWithInputState = function ($input) {\n  var targetId = $input.getAttribute('aria-controls')\n  if (!targetId) {\n    return\n  }\n\n  var $target = document.getElementById(targetId)\n  if ($target && $target.classList.contains('govuk-checkboxes__conditional')) {\n    var inputIsChecked = $input.checked\n\n    $input.setAttribute('aria-expanded', inputIsChecked.toString())\n    $target.classList.toggle('govuk-checkboxes__conditional--hidden', !inputIsChecked)\n  }\n}\n\n/**\n * Uncheck other checkboxes\n *\n * Find any other checkbox inputs with the same name value, and uncheck them.\n * This is useful for when a “None of these\" checkbox is checked.\n *\n * @deprecated Will be made private in v5.0\n * @param {HTMLInputElement} $input - Checkbox input\n */\nCheckboxes.prototype.unCheckAllInputsExcept = function ($input) {\n  var $component = this\n\n  /** @type {NodeListOf<HTMLInputElement>} */\n  // @ts-expect-error `NodeListOf<HTMLInputElement>` type expected\n  var allInputsWithSameName = document.querySelectorAll(\n    'input[type=\"checkbox\"][name=\"' + $input.name + '\"]'\n  )\n\n  nodeListForEach(allInputsWithSameName, function ($inputWithSameName) {\n    var hasSameFormOwner = ($input.form === $inputWithSameName.form)\n    if (hasSameFormOwner && $inputWithSameName !== $input) {\n      $inputWithSameName.checked = false\n      $component.syncConditionalRevealWithInputState($inputWithSameName)\n    }\n  })\n}\n\n/**\n * Uncheck exclusive checkboxes\n *\n * Find any checkbox inputs with the same name value and the 'exclusive' behaviour,\n * and uncheck them. This helps prevent someone checking both a regular checkbox and a\n * \"None of these\" checkbox in the same fieldset.\n *\n * @deprecated Will be made private in v5.0\n * @param {HTMLInputElement} $input - Checkbox input\n */\nCheckboxes.prototype.unCheckExclusiveInputs = function ($input) {\n  var $component = this\n\n  /** @type {NodeListOf<HTMLInputElement>} */\n  // @ts-expect-error `NodeListOf<HTMLInputElement>` type expected\n  var allInputsWithSameNameAndExclusiveBehaviour = document.querySelectorAll(\n    'input[data-behaviour=\"exclusive\"][type=\"checkbox\"][name=\"' + $input.name + '\"]'\n  )\n\n  nodeListForEach(allInputsWithSameNameAndExclusiveBehaviour, function ($exclusiveInput) {\n    var hasSameFormOwner = ($input.form === $exclusiveInput.form)\n    if (hasSameFormOwner) {\n      $exclusiveInput.checked = false\n      $component.syncConditionalRevealWithInputState($exclusiveInput)\n    }\n  })\n}\n\n/**\n * Click event handler\n *\n * Handle a click within the $module – if the click occurred on a checkbox, sync\n * the state of any associated conditional reveal with the checkbox state.\n *\n * @deprecated Will be made private in v5.0\n * @param {MouseEvent} event - Click event\n */\nCheckboxes.prototype.handleClick = function (event) {\n  var $clickedInput = event.target\n\n  // Ignore clicks on things that aren't checkbox inputs\n  if (!($clickedInput instanceof HTMLInputElement) || $clickedInput.type !== 'checkbox') {\n    return\n  }\n\n  // If the checkbox conditionally-reveals some content, sync the state\n  var hasAriaControls = $clickedInput.getAttribute('aria-controls')\n  if (hasAriaControls) {\n    this.syncConditionalRevealWithInputState($clickedInput)\n  }\n\n  // No further behaviour needed for unchecking\n  if (!$clickedInput.checked) {\n    return\n  }\n\n  // Handle 'exclusive' checkbox behaviour (ie \"None of these\")\n  var hasBehaviourExclusive = ($clickedInput.getAttribute('data-behaviour') === 'exclusive')\n  if (hasBehaviourExclusive) {\n    this.unCheckAllInputsExcept($clickedInput)\n  } else {\n    this.unCheckExclusiveInputs($clickedInput)\n  }\n}\n\nexport default Checkboxes\n"],"names":[],"mappings":"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"}