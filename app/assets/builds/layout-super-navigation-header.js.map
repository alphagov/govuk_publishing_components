{"version":3,"file":"layout-super-navigation-header.js","sources":["../javascripts/govuk_publishing_components/modules/layout-super-navigation-header.js"],"sourcesContent":["var SETTINGS = {\n  breakpoint: {\n    desktop: 769\n  },\n  label: {\n    hide: 'data-text-for-hide',\n    show: 'data-text-for-show'\n  }\n}\n\nvar setLabel = function ($button, showOrHide) {\n  var newLabel = $button.getAttribute(SETTINGS.label[showOrHide])\n\n  if (newLabel) {\n    $button.setAttribute('aria-label', newLabel)\n  }\n}\n\n// Wrapper functions to contain all of the mechanisms needed for hiding and\n// toggling the menus.\nvar hide = function ($button, $menu) {\n  $button.setAttribute('aria-expanded', false)\n  $button.classList.remove('gem-c-layout-super-navigation-header__open-button')\n  $menu.setAttribute('hidden', 'hidden')\n  setLabel($button, 'show')\n}\nvar show = function ($button, $menu) {\n  $button.setAttribute('aria-expanded', true)\n  $button.classList.add('gem-c-layout-super-navigation-header__open-button')\n  $menu.removeAttribute('hidden')\n  setLabel($button, 'hide')\n  console.log('showing, module')\n}\n\nvar toggle = function ($button, $menu) {\n  var isOpen = $button.getAttribute('aria-expanded') === 'true'\n  var trackingLabel = $button.getAttribute('data-tracking-key')\n  if (isOpen) {\n    hide($button, $menu)\n  } else {\n    show($button, $menu)\n  }\n\n  // Fire analytics if analytics are available\n  if (window.GOVUK.analytics && window.GOVUK.analytics.trackEvent && trackingLabel) {\n    window.GOVUK.analytics.trackEvent('headerClicked', trackingLabel + (isOpen ? 'Closed' : 'Opened'), { label: 'none' })\n  }\n}\n\n// Clicking an element inside a `button` element causes the `event.target` to\n// be the inside element, not the button. This can be taken care of by setting\n// the CSS pointer-events to be none, but that doesn't work for older\n// browsers, won't work for people with CSS turned off, or for people who are\n// using CSS overrides.\n//    This checks if the $element is the `elementType`; if it is, it gets\n// returned; if not it recursively checks to see if the parent element is a\n// `elementType`. This means that it can be used with `pointer-events: none`.\nvar closestParentIncluding = function ($element, elementType) {\n  if ($element.tagName.toLowerCase() === elementType.toLowerCase()) {\n    return $element\n  }\n  return closestParentIncluding($element.parentNode, elementType)\n}\n\n// Searched the previous elements to find one with the same tag as set in\n// `elementType` . If it's found the element is returned; if not, it returns\n// null.\nvar closestPrevious = function ($element, elementType) {\n  if ($element === null) {\n    return null\n  }\n\n  // Using `previousSibling` means that there is a possibility that the\n  // $element could be a text node or a comment node - checking the `nodeType`\n  // of the element will ensure that it's a real element.\n  if ($element.nodeType === 1 && $element.tagName.toLowerCase() === elementType.toLowerCase()) {\n    return $element\n  }\n\n  // If `previousElementSibling` can be used then let's use it as it'll be\n  // slightly faster since it skips things that aren't elements. If not,\n  // `previousSibling` can still be used as there's a `nodeType` check.\n  var previousElement = $element.previousElementSibling || $element.previousSibling\n\n  return closestPrevious(previousElement, elementType)\n}\n\nclass LayoutSuperNavigationHeader {\n\n  constructor($module) {\n    this.$module = $module\n    this.$searchToggle = this.$module.querySelector('#super-search-menu-toggle')\n    this.$searchMenu = this.$module.querySelector('#super-search-menu')\n\n    // The menu toggler buttons need three attributes for this to work:\n    //  - `aria-controls` contains the id of the menu to be toggled\n    //  - `data-toggle-mobile-group` is the group that the menu belongs to on\n    //    smaller screens\n    //  - `data-toggle-desktop-group` is the group that the menu belongs to on\n    //    larger screens\n    this.$buttons = this.$module.querySelectorAll(\n      'button[aria-controls][data-toggle-mobile-group][data-toggle-desktop-group]'\n    )\n\n    this.hiddenButtons = this.$module.querySelectorAll('button[hidden]')    \n  }\n\n  updateStates() {\n    // Check whether any of the dropdown menus are open.\n    var $openButton = this.$module.querySelector('[aria-expanded=\"true\"][data-toggle-desktop-group=\"top\"]')\n    // Gets the open dropdown menu\n    var $openMenu = $openButton ? this.$module.querySelector('#' + $openButton.getAttribute('aria-controls')) : null\n    // If there is an open dropdown menu, get the height of the dropdown menu.\n    var margin = $openMenu ? $openMenu.offsetHeight : 0\n\n    // Make space for the dropdown menu.\n    this.$module.style.marginBottom = margin + 'px'\n  }\n\n  buttonHandler(event) {\n    var $target = closestParentIncluding(event.target, 'button')\n    var $targetMenu = this.$module.querySelector('#' + $target.getAttribute('aria-controls'))\n\n    var toggleGroupAttribute = 'data-toggle-desktop-group'\n    var toggleGroupName = $target.getAttribute(toggleGroupAttribute)\n    var toggleGroupList = this.$module.querySelectorAll('[' + toggleGroupAttribute + '=\"' + toggleGroupName + '\"]')\n\n    for (var k = 0; k < toggleGroupList.length; k++) {\n      var $element = toggleGroupList[k]\n      if ($element !== $target) {\n        var $menu = this.$module.querySelector('#' + $element.getAttribute('aria-controls'))\n        hide($element, $menu)\n      }\n    }\n\n    toggle($target, $targetMenu)\n\n    this.$module.style.marginBottom = $targetMenu.offsetHeight + 'px'\n  }\n\n  init() {\n    for (var j = 0; j < this.$buttons.length; j++) {\n      var $button = this.$buttons[j]\n      $button.addEventListener('click', this.buttonHandler.bind(this), true)\n    }\n\n    // The toggle buttons are hardcoded to be hidden in the markup - this means\n    // that people without JavaScript turned on won't have buttons present that\n    // don't do anything.\n    //     Since JavaScript is enabled we can remove the hidden attribute from\n    // the buttons so that they're perceivable by users.\n    //     As the toggle buttons are now selectable, we should prevent the links\n    // from being selectable to avoid confusion.\n    for (var i = 0; i < this.hiddenButtons.length; i++) {\n      var $element = this.hiddenButtons[i]\n      $element.removeAttribute('hidden')\n\n      var closestSiblingLink = closestPrevious($element, 'a')\n\n      if (closestSiblingLink) {\n        closestSiblingLink.setAttribute('hidden', 'hidden')\n      }\n    }\n\n    this.$module.querySelector('.gem-c-layout-super-navigation-header__search-item-link')\n      .setAttribute('hidden', 'hidden')\n\n    // Navigation menu and search menu are hardcoded to be open in the markup -\n    // this means that the menu still makes sense with CSS and JavaScript turned\n    // off.\n    //     The menus now need to be hidden as part of the JavaScript\n    // initialisation.\n    //   - On both mobile and desktop, this means hiding the search menu\n    //   - On mobile, this means hiding the navigation\n    //   - On desktop, this means hiding the navigation button, showing the\n    //     second level navigation menu\n    hide(this.$searchToggle, this.$searchMenu)\n    this.updateStates()\n\n    // The menu needs to be updated when the window is resized to make sure that\n    // the space needed for the dropdown menu is correct.\n    window.addEventListener('resize', this.updateStates.bind(this), { passive: true })\n\n    this.$module.classList.add('js-module-initialised')\n  }\n}\n\nexport default LayoutSuperNavigationHeader;\n"],"names":[],"mappings":"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"}