{
  "version": 3,
  "sources": ["../javascripts/govuk_publishing_components/modules/accordion.js"],
  "sourcesContent": ["class GemAccordion {\n  constructor($module) {\n    this.$module = $module\n    this.sectionClass = 'govuk-accordion__section'\n    this.sectionExpandedClass = 'govuk-accordion__section--expanded'\n    this.sectionInnerContentClass = 'govuk-accordion__section-content'\n\n    this.sectionHeader = '.govuk-accordion__section-header'\n    this.showAllControls = '.govuk-accordion__show-all'\n    this.sectionButton = '.govuk-accordion__section-button'\n    this.headingText = '.govuk-accordion__section-heading-text'\n\n    // language attribute pulled from data attributes\n    this.$module.actions = {}\n    this.$module.actions.locale = this.$module.getAttribute('data-locale')\n  }\n\n  init() {\n    // Indicate that JavaScript has worked\n    this.$module.querySelector(this.showAllControls).classList.add('gem-c-accordion__show-all')\n\n    // Feature flag for anchor tag navigation used on manuals\n    if (this.$module.getAttribute('data-anchor-navigation') === 'true') {\n      this.openByAnchorOnLoad()\n      this.addEventListenersForAnchors()\n    }\n    // Feature flag for \"Show all sections\" GA click event tracking\n    if (this.$module.getAttribute('data-track-show-all-clicks') === 'true') {\n      this.addAccordionOpenAllTracking()\n    }\n    // Feature flag for each section GA click event tracking\n    if (this.$module.getAttribute('data-track-sections') === 'true') {\n      this.addEventListenerSections()\n    }\n\n    // look for data attributes to put onto the 'show/hide all' link\n    var showAllAttributes = this.$module.getAttribute('data-show-all-attributes')\n    var showAll\n    if (showAllAttributes) {\n      try {\n        showAll = this.$module.querySelector(this.showAllControls)\n        var values = JSON.parse(showAllAttributes)\n        var keys = Object.keys(values)\n        for (var i = 0; i < keys.length; i++) {\n          showAll.setAttribute('data-' + keys[i], values[keys[i]])\n        }\n      } catch (e) {\n        console.error('Could not read accordion data attributes error: ' + e.message, window.location)\n      }\n    }\n\n    // if GA4 is enabled, set attributes on 'show all sections' for tracking using ga4-event-tracker\n    var dataModule = this.$module.getAttribute('data-module')\n    var isGa4Enabled = dataModule ? dataModule.indexOf('ga4-event-tracker') !== -1 : false\n    if (isGa4Enabled) {\n      var indexTotal = this.$module.querySelectorAll('.govuk-accordion__section').length\n      var showAllAttributesGa4 = { event_name: 'select_content', type: 'accordion', index: 0, index_total: indexTotal }\n      showAll = this.$module.querySelector(this.showAllControls)\n      showAll.setAttribute('data-ga4-event', JSON.stringify(showAllAttributesGa4))\n    }    \n  }\n\n// Navigate to and open accordions with anchored content on page load if a hash is present\n  openByAnchorOnLoad() {\n    if (!window.location.hash) return\n    var splitHash = window.location.hash.split('#')[1]\n    this.openForAnchor(splitHash)\n  }\n\n  // Add event listeners for links to open accordion sections when navigated to using said anchor links on the page\n  // Adding an event listener to all anchor link a tags in an accordion is risky but we circumvent this risk partially by only being a layer of accordion behaviour instead of any sort of change to link behaviour\n  addEventListenersForAnchors() {\n    var links = this.$module.querySelectorAll(this.sectionInnerContentClass + ' a[href*=\"#\"]')\n\n    nodeListForEach(links, function (link) {\n      if (link.pathname === window.location.pathname) {\n        link.addEventListener('click', this.openForAnchor.bind(this, link.hash.split('#')[1]))\n      }\n    }.bind(this))\n  }\n\n  // Find the parent accordion section for the given id and open it\n  openForAnchor(hash) {\n    hash = hash.replace(':', '\\\\:')\n    var target = this.$module.querySelector('#' + hash)\n    if (!target) return\n    var $section = this.getContainingSection(target)\n    var $header = $section.querySelector(this.sectionHeader)\n    var $expanded = this.getContainingSection($section)\n    var $parent = $header.parentElement\n\n    // government-frontend features (inherited from manuals-frontend):\n    // Should the target anchor link be within the same page, open section - navigate normally\n    // Should the target anchor link be within a different, closed section, open this section\n    // Should the target anchor link be within a different page and different, closed section open this section\n    if ($expanded && (!$parent.classList.contains(this.sectionExpandedClass))) {\n      $header.click()\n    }\n  }\n\n  // Loop through the given id's ancestors until the parent section class is found\n  getContainingSection(target) {\n    while (!target.classList.contains(this.sectionClass)) {\n      target = target.parentElement\n    }\n    return target\n  }\n\n  filterLocale(key) {\n    if (this.$module.actions.locale && this.$module.actions.locale.indexOf('{') !== -1) {\n      var locales = JSON.parse(this.$module.actions.locale)\n      return locales[key]\n    } else if (this.$module.actions.locale) {\n      return this.$module.actions.locale\n    }\n  }\n\n  // To track the Accordion's \"Show all sections\" / \"Hide all sections\" button click events and pass them to the GA event tracking\n  addAccordionOpenAllTracking() {\n    this.$module.querySelector(this.showAllControls).addEventListener('click', function (event) {\n      var expanded = event.target.getAttribute('aria-expanded') === 'true'\n      var label = expanded ? 'Show all sections' : 'Hide all sections'\n      var action = expanded ? 'accordionOpened' : 'accordionClosed'\n      var options = { transport: 'beacon', label: label }\n\n      var extraOptions = event.target && event.target.getAttribute('data-track-options')\n\n      // this uses the same logic as track-click.js handleClick\n      // means we can add a custom dimensions on click\n      if (extraOptions) {\n        extraOptions = JSON.parse(extraOptions)\n        for (var k in extraOptions) options[k] = extraOptions[k]\n      }\n\n      if (window.GOVUK.analytics && window.GOVUK.analytics.trackEvent) {\n        window.GOVUK.analytics.trackEvent('pageElementInteraction', action, options)\n      }\n    })\n  }\n\n  addEventListenerSections() {\n    var sections = this.$module.querySelectorAll(this.sectionButton)\n    nodeListForEach(sections, function (section) {\n      section.addEventListener('click', this.addAccordionSectionTracking.bind(this, section))\n    }.bind(this))\n  }\n\n  // If the Accordion's sections are opened on click, then pass them to the GA event tracking\n  addAccordionSectionTracking(section) {\n    var expanded = section.getAttribute('aria-expanded') === 'false'\n    var label = section.querySelector(this.headingText).textContent\n    var action = expanded ? 'accordionOpened' : 'accordionClosed'\n    var options = { transport: 'beacon', label: label }\n\n    // optional parameters are added to the parent\n    // heading not the button that is clicked\n    var extraOptions = section.parentElement && section.parentElement.getAttribute('data-track-options')\n\n    // this uses the same logic as track-click.js handleClick\n    // means we can add a custom dimensions on click\n    // (such as the index of the accordion on the page)\n    if (extraOptions) {\n      extraOptions = JSON.parse(extraOptions)\n      for (var k in extraOptions) options[k] = extraOptions[k]\n    }\n\n    if (window.GOVUK.analytics && window.GOVUK.analytics.trackEvent) {\n      window.GOVUK.analytics.trackEvent('pageElementInteraction', action, options)\n    }\n  }\n}\n\nexport default GemAccordion;\n"],
  "mappings": "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",
  "names": []
}
