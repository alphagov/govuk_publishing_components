{"version":3,"file":"gem-accordion.js","sources":["../javascripts/govuk_publishing_components/modules/gem-accordion.js"],"sourcesContent":["class GemAccordion {\n  constructor($module) {\n    this.$module = $module\n    this.sectionClass = 'govuk-accordion__section'\n    this.sectionExpandedClass = 'govuk-accordion__section--expanded'\n    this.sectionInnerContentClass = 'govuk-accordion__section-content'\n\n    this.sectionHeader = '.govuk-accordion__section-header'\n    this.showAllControls = '.govuk-accordion__show-all'\n    this.sectionButton = '.govuk-accordion__section-button'\n    this.headingText = '.govuk-accordion__section-heading-text'\n\n    // language attribute pulled from data attributes\n    this.$module.actions = {}\n    this.$module.actions.locale = this.$module.getAttribute('data-locale')\n  }\n\n  init() {\n    // Indicate that JavaScript has worked\n    this.$module.querySelector(this.showAllControls).classList.add('gem-c-accordion__show-all')\n\n    // Feature flag for anchor tag navigation used on manuals\n    if (this.$module.getAttribute('data-anchor-navigation') === 'true') {\n      this.openByAnchorOnLoad()\n      this.addEventListenersForAnchors()\n    }\n    // Feature flag for \"Show all sections\" GA click event tracking\n    if (this.$module.getAttribute('data-track-show-all-clicks') === 'true') {\n      this.addAccordionOpenAllTracking()\n    }\n    // Feature flag for each section GA click event tracking\n    if (this.$module.getAttribute('data-track-sections') === 'true') {\n      this.addEventListenerSections()\n    }\n\n    // look for data attributes to put onto the 'show/hide all' link\n    var showAllAttributes = this.$module.getAttribute('data-show-all-attributes')\n    var showAll\n    if (showAllAttributes) {\n      try {\n        showAll = this.$module.querySelector(this.showAllControls)\n        var values = JSON.parse(showAllAttributes)\n        var keys = Object.keys(values)\n        for (var i = 0; i < keys.length; i++) {\n          showAll.setAttribute('data-' + keys[i], values[keys[i]])\n        }\n      } catch (e) {\n        console.error('Could not read accordion data attributes error: ' + e.message, window.location)\n      }\n    }\n\n    // if GA4 is enabled, set attributes on 'show all sections' for tracking using ga4-event-tracker\n    var dataModule = this.$module.getAttribute('data-module')\n    var isGa4Enabled = dataModule ? dataModule.indexOf('ga4-event-tracker') !== -1 : false\n    if (isGa4Enabled) {\n      var indexTotal = this.$module.querySelectorAll('.govuk-accordion__section').length\n      var showAllAttributesGa4 = { event_name: 'select_content', type: 'accordion', index: 0, index_total: indexTotal }\n      showAll = this.$module.querySelector(this.showAllControls)\n      showAll.setAttribute('data-ga4-event', JSON.stringify(showAllAttributesGa4))\n    }    \n  }\n\n// Navigate to and open accordions with anchored content on page load if a hash is present\n  openByAnchorOnLoad() {\n    if (!window.location.hash) return\n    var splitHash = window.location.hash.split('#')[1]\n    this.openForAnchor(splitHash)\n  }\n\n  // Add event listeners for links to open accordion sections when navigated to using said anchor links on the page\n  // Adding an event listener to all anchor link a tags in an accordion is risky but we circumvent this risk partially by only being a layer of accordion behaviour instead of any sort of change to link behaviour\n  addEventListenersForAnchors() {\n    var links = this.$module.querySelectorAll(this.sectionInnerContentClass + ' a[href*=\"#\"]')\n\n    nodeListForEach(links, function (link) {\n      if (link.pathname === window.location.pathname) {\n        link.addEventListener('click', this.openForAnchor.bind(this, link.hash.split('#')[1]))\n      }\n    }.bind(this))\n  }\n\n  // Find the parent accordion section for the given id and open it\n  openForAnchor(hash) {\n    hash = hash.replace(':', '\\\\:')\n    var target = this.$module.querySelector('#' + hash)\n    if (!target) return\n    var $section = this.getContainingSection(target)\n    var $header = $section.querySelector(this.sectionHeader)\n    var $expanded = this.getContainingSection($section)\n    var $parent = $header.parentElement\n\n    // government-frontend features (inherited from manuals-frontend):\n    // Should the target anchor link be within the same page, open section - navigate normally\n    // Should the target anchor link be within a different, closed section, open this section\n    // Should the target anchor link be within a different page and different, closed section open this section\n    if ($expanded && (!$parent.classList.contains(this.sectionExpandedClass))) {\n      $header.click()\n    }\n  }\n\n  // Loop through the given id's ancestors until the parent section class is found\n  getContainingSection(target) {\n    while (!target.classList.contains(this.sectionClass)) {\n      target = target.parentElement\n    }\n    return target\n  }\n\n  filterLocale(key) {\n    if (this.$module.actions.locale && this.$module.actions.locale.indexOf('{') !== -1) {\n      var locales = JSON.parse(this.$module.actions.locale)\n      return locales[key]\n    } else if (this.$module.actions.locale) {\n      return this.$module.actions.locale\n    }\n  }\n\n  // To track the Accordion's \"Show all sections\" / \"Hide all sections\" button click events and pass them to the GA event tracking\n  addAccordionOpenAllTracking() {\n    this.$module.querySelector(this.showAllControls).addEventListener('click', function (event) {\n      var expanded = event.target.getAttribute('aria-expanded') === 'true'\n      var label = expanded ? 'Show all sections' : 'Hide all sections'\n      var action = expanded ? 'accordionOpened' : 'accordionClosed'\n      var options = { transport: 'beacon', label: label }\n\n      var extraOptions = event.target && event.target.getAttribute('data-track-options')\n\n      // this uses the same logic as track-click.js handleClick\n      // means we can add a custom dimensions on click\n      if (extraOptions) {\n        extraOptions = JSON.parse(extraOptions)\n        for (var k in extraOptions) options[k] = extraOptions[k]\n      }\n\n      if (window.GOVUK.analytics && window.GOVUK.analytics.trackEvent) {\n        window.GOVUK.analytics.trackEvent('pageElementInteraction', action, options)\n      }\n    })\n  }\n\n  addEventListenerSections() {\n    var sections = this.$module.querySelectorAll(this.sectionButton)\n    nodeListForEach(sections, function (section) {\n      section.addEventListener('click', this.addAccordionSectionTracking.bind(this, section))\n    }.bind(this))\n  }\n\n  // If the Accordion's sections are opened on click, then pass them to the GA event tracking\n  addAccordionSectionTracking(section) {\n    var expanded = section.getAttribute('aria-expanded') === 'false'\n    var label = section.querySelector(this.headingText).textContent\n    var action = expanded ? 'accordionOpened' : 'accordionClosed'\n    var options = { transport: 'beacon', label: label }\n\n    // optional parameters are added to the parent\n    // heading not the button that is clicked\n    var extraOptions = section.parentElement && section.parentElement.getAttribute('data-track-options')\n\n    // this uses the same logic as track-click.js handleClick\n    // means we can add a custom dimensions on click\n    // (such as the index of the accordion on the page)\n    if (extraOptions) {\n      extraOptions = JSON.parse(extraOptions)\n      for (var k in extraOptions) options[k] = extraOptions[k]\n    }\n\n    if (window.GOVUK.analytics && window.GOVUK.analytics.trackEvent) {\n      window.GOVUK.analytics.trackEvent('pageElementInteraction', action, options)\n    }\n  }\n}\n\nexport default GemAccordion;\n"],"names":[],"mappings":"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"}